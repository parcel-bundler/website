# ğŸ“š API

## ë²ˆë“¤ëŸ¬

ë³´ë‹¤ ë³µì¡í•œ ì‚¬ìš©ì„ ìœ„í•´(ê°€ë ¹ ë§¤ ë¹Œë“œ í›„ ì„ì˜ì˜ í”„ë¡œì„¸ì‹±ì„ í•´ì•¼í•œë‹¤ë˜ê°€) CLI ëŒ€ì‹  API ë¥¼ ì´ìš©í•´ì„œ ë²ˆë“¤ëŸ¬ë¥¼ ì´ˆê¸°í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ëª¨ë“  ì˜µì…˜ì´ ì„¤ëª…ëœ ì•„ë˜ ì˜ˆì‹œë¥¼ ë³´ì„¸ìš”.

```js
const Bundler = require('parcel-bundler')
const Path = require('path')

// ì§„ì…ì  íŒŒì¼ ìœ„ì¹˜
const file = Path.join(__dirname, './index.html')

// ë²ˆë“¤ëŸ¬ ì˜µì…˜
const options = {
  outDir: './dist', // ë¹Œë“œ ê²°ê³¼ë¬¼ì´ ì €ì¥ë  ë””ë ‰í† ë¦¬. ê¸°ë³¸ê°’ì€ dist
  outFile: 'index.html', // ê²°ê³¼ë¬¼ì˜ íŒŒì¼ëª…
  publicUrl: '/', // ì„œë²„ìƒì˜ ìœ„ì¹˜. ê¸°ë³¸ê°’ì€ '/'
  watch: true, // íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•´ì„œ ë³€ê²½ì‹œ ë‹¤ì‹œ ë¹Œë“œí• ì§€ ì—¬ë¶€. ê¸°ë³¸ê°’ì€ process.env.NODE_ENV !== 'production'
  cache: true, // ìºì‹œë¥¼ í™œì„±í™”í• ì§€ ì—¬ë¶€. ê¸°ë³¸ê°’ì€ true
  cacheDir: '.cache', // ìºì‹œë¥¼ ì €ì¥í•  ë””ë ‰í† ë¦¬. ê¸°ë³¸ê°’ì€ .cache
  minify: false, // íŒŒì¼ ë¯¸ë‹ˆíŒŒì´ì¼€ì´ì…˜. process.env.NODE_ENV === 'production'ë©´ í™œì„±í™”ë¨.
  target: 'browser', // browser/node/electron, ê¸°ë³¸ê°’ì€ browser
  https: false, // íŒŒì¼ì„ httpsë¡œ ì„œë¹™í• ì§€ httpë¡œ í• ì§€ ì—¬ë¶€. ê¸°ë³¸ê°’ì€ false
  logLevel: 3, // 3 = ëª¨ë“ ê²ƒì„ ë¡œê¹…, 2 = ê²½ê³ ì™€ ì—ëŸ¬ë¥¼ ë¡œê¹…, 1 = ì—ëŸ¬ë§Œ ë¡œê¹…
  hmrPort: 0, // HMR ì†Œì¼“ì´ ëŒì•„ê°ˆ í¬íŠ¸ë²ˆí˜¸. ê¸°ë³¸ê°’ì€ ë¬´ì‘ìœ„ì˜ ë¹ˆ í¬íŠ¸ (node.jsì—ì„œ 0ì€ ë¬´ì‘ìœ„ì˜ ë¹ˆ í¬íŠ¸ë¡œ ë°°ì •ë¨)
  sourceMaps: true, // ì†ŒìŠ¤ë§µì„ í™œì„±í™”í• ì§€ ì—¬ë¶€. ê¸°ë³¸ê°’ì€ í™œì„±í™” (ì•„ì§ ë¯¸ë‹ˆíŒŒì´ë“œ ë¹Œë“œì—ì„  ì§€ì›ë˜ì§€ ì•ŠìŒ)
  hmrHostname: '', // ë¹ ë¥¸ ëª¨ë“ˆ êµì²´ë¥¼ ìœ„í•œ hostname.ê¸°ë³¸ê°’ì€ ''
  detailedReport: false // ë²ˆë“¤, ì• ì…‹, íŒŒì¼ í¬ê¸°, ë¹Œë“œ ì‹œê°„ì„ ë‹´ì€ ìƒì„¸í•œ ë¦¬í¬íŠ¸ë¥¼ ì¶œë ¥. ê¸°ë³¸ê°’ì€ false. ë¦¬í¬íŠ¸ëŠ” ì˜¤ì§ watchê°€ ë¹„í™œì„±ì¼ë•Œë§Œ ì¶œë ¥ë¨
}

async function runBundle() {
  // ì§„ì…ì  ìœ„ì¹˜ì™€ ì˜µì…˜ì„ ì œê³µí•´ì„œ ë²ˆë“¤ëŸ¬ë¥¼ ì´ˆê¸°í™”
  const bundler = new Bundler(file, options)

  // ë²ˆë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•¨. ì´ê²ƒì€ ë©”ì¸ ë²ˆë“¤ì„ ë°˜í™˜í•¨.
  // watch ëª¨ë“œë¥¼ ì‚¬ìš©í•  ê²½ìš° ì´ promiseëŠ” ë§¤ ë¹Œë“œë§ˆë‹¤ í˜¸ì¶œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë”± í•œ ë²ˆë§Œ í˜¸ì¶œí•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•  ê²ƒ
  const bundle = await bundler.bundle()
}

runBundle()
```

### ì´ë²¤íŠ¸

ëª¨ë“  ë²ˆë“¤ëŸ¬ ì´ë²¤íŠ¸ ëª©ë¡ì…ë‹ˆë‹¤.

- `bundled` ì´ë²¤íŠ¸ëŠ” **ì²˜ìŒ í•œ ë²ˆë§Œ**, Parcel ì´ ì„±ê³µì ìœ¼ë¡œ ë²ˆë“¤ë§ì„ ë§ˆì¹œ í›„ ë°œìƒë˜ì–´, ë©”ì¸ [ë²ˆë“¤](#ë²ˆë“¤)ì„ callback ì— ì „ë‹¬í•©ë‹ˆë‹¤.

```js
const bundler = new Bundler(...);
bundler.on('bundled', (bundler) => {
  // bundlerëŠ” ëª¨ë“  ì• ì…‹ê³¼ ë²ˆë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤. ìì„¸í•œê±´ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
});
// ì–´ë””ì„ ê°€ bundler.bundle() ë¥¼ í˜¸ì¶œí•¨
```

- `buildEnd` ì´ë²¤íŠ¸ëŠ” **ì¬ë¹Œë“œë¥¼ í¬í•¨í•œ** ë¹Œë“œ í›„ ë§¤ë²ˆ ë°œìƒë©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì—ë„ ë°œìƒí•©ë‹ˆë‹¤.

```js
const bundler = new Bundler(...);
bundler.on('buildEnd', () => {
  // Do something...
});
// ì–´ë””ì„ ê°€ bundler.bundle() ë¥¼ í˜¸ì¶œí•¨
```

### ë²ˆë“¤

`Bundle`ì€ Parcel ì´ ì• ì…‹ì„ í•¨ê»˜ ë²ˆë“¤ë§í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ë©°, ë²ˆë“¤ íŠ¸ë¦¬ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•´ ìì‹, í˜•ì œ ë²ˆë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.

#### ì†ì„±ë“¤

- `type`: ì• ì…‹ì˜ ì¢…ë¥˜ (e.g. js, css, map, ...)
- `name`: ë²ˆë“¤ì˜ ì´ë¦„ (`entryAsset`ì˜ `Asset.generateBundleName()`ë¡œ ìƒì„±)
- `parentBundle`: ë¶€ëª¨ ë²ˆë“¤. ì§„ì…ì  ë²ˆë“¤ì¼ ê²½ìš° null
- `entryAsset`: ë²ˆë“¤ì˜ ì§„ì…ì . name ì˜ ìƒì„± ë° ì• ì…‹ ìˆ˜ì§‘ì— ì‚¬ìš©.
- `assets`: ë²ˆë“¤ ì•ˆì— ìˆëŠ” ëª¨ë“  ì• ì…‹ì˜ ì§‘í•©(`Set`)
- `childBundles`: ëª¨ë“  ìì‹ ë²ˆë“¤ì˜ `Set`
- `siblingBundles`: ëª¨ë“  í˜•ì œ ë²ˆë“¤ì˜ `Set`
- `siblingBundlesMap`: ëª¨ë“  í˜•ì œ ë²ˆë“¤ì˜ `Map<String(Type: js, css, map, ...), Bundle>`
- `offsets`: ë²ˆë“¤ ì•ˆì˜ ì• ì…‹ ì†ì˜ ëª¨ë“  ìœ„ì¹˜ì˜ `Map<Asset, number(bundle ì•ˆì˜ ì¤„ ë²ˆí˜¸)>`. ì •í™•í•œ ì†ŒìŠ¤ë§µ ìƒì„±ì„ ìœ„í•´ ì‚¬ìš©ë¨

#### Tree

`Bundle`ì€ `parentBundle`, `childBundles`, `siblingBundles`ì„ í¬í•¨í•˜ê³ , ì´ ëª¨ë“  ì†ì„±ì€ ë¹ ë¥´ê²Œ ë²ˆë“¤íŠ¸ë¦¬ë¥¼ ìˆœíšŒí•˜ì—¬ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

ë§¤ìš° ê¸°ë³¸ì ì¸ ì• ì…‹ íŠ¸ë¦¬ë¡œ ë²ˆë“¤ íŠ¸ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

##### ì• ì…‹ íŠ¸ë¦¬

`index.html`ëŠ” `index.js`ì™€ `index.css`ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

`index.js`ëŠ” `test.js`ì™€ `test.txt`ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

```Text
index.html
-- index.js
 |--- test.js
 |--- test.txt
-- index.css
```

##### ë²ˆë“¤ íŠ¸ë¦¬:

`index.html`ì€ ë©”ì¸ ë²ˆë“¤ì„ ìœ„í•´ ì§„ì… ì• ì…‹ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ë©”ì¸ ë²ˆë“¤ì€ `index.js`ê³¼ `index.css` 2 ê°œì˜ ìì‹ ë²ˆë“¤ì„ ë§Œë“­ë‹ˆë‹¤. ë‘˜ ë‹¤ `html`ê³¼ ë‹¤ë¥¸ íƒ€ì…ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

`index.js`ëŠ” `test.js`, `test.txt` ë‘ íŒŒì¼ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

`test.js`ì€ `index.js` ë²ˆë“¤ì˜ ì• ì…‹ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. `index.js`ì™€ ê°™ì€ ì—ìƒ› íƒ€ì…ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

`test.txt`ëŠ” `index.js`ì™€ ë‹¤ë¥¸ ì• ì…‹ íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ì´ë¥¼ ìœ„í•´ ìƒˆ ë²ˆë“¤ì´ ìƒì„±ë˜ê³ , í•´ë‹¹ ë²ˆë“¤ì€ `index.js` ë²ˆë“¤ì˜ ìì‹ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.

`index.css`ëŠ” ë‹¤ë¥¸ ì˜ì¡´ì„±ì´ ì—†ê³ , ì—”íŠ¸ë¦¬ ì• ì…‹ì—ì„œë§Œ ì“°ì…ë‹ˆë‹¤.

`index.css`ì™€ `index.js` ë²ˆë“¤ì€ ê°™ì€ ë¶€ëª¨ë¥¼ ê°€ì§€ë¯€ë¡œ ì„œë¡œì˜ í˜•ì œ ë²ˆë“¤ ì…ë‹ˆë‹¤.

```Text
index.html
-- index.js (index.jsì™€ test.jsë¥¼ í¬í•¨)
 |--- test.txt (test.txtë¥¼ í¬í•¨)
-- index.css (index.cssë¥¼ í¬í•¨)
```

### Middleware

ë¯¸ë“¤ì›¨ì–´ëŠ” http ì„œë²„ì˜ í›…ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆë¥¼ ë“¤ì–´ `express`ë‚˜ node `http`).

Parcel ë¯¸ë“¤ì›¨ì–´ë¥¼ express ì™€ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

```js
const Bundler = require('parcel-bundler')
const app = require('express')()

const file = 'index.html' // ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ë¡œ ì“°ì¼ ì ˆëŒ€ê²½ë¡œë¥¼ ì ìŠµë‹ˆë‹¤
const options = {} // ê°€ëŠ¥í•œ ì˜µì…˜ì€ API ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”

// íŒŒì¼ê³¼ ì˜µì…˜ì„ ì‚¬ìš©í•´ ë²ˆë“¤ëŸ¬ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤
const bundler = new Bundler(file, options)

// expressê°€ ë²ˆë“¤ëŸ¬ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ express serverë¥¼ ê±°ì¹˜ëŠ” ë§¤ ìš”ì²­ì„ Parcelì´ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.
app.use(bundler.middleware())

// 8080í¬íŠ¸ë¡œ listenì„ ì‹œì‘í•©ë‹ˆë‹¤.
app.listen(8080)
```
