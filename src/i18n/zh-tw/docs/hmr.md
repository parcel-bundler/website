# ğŸ”¥ æ¨¡çµ„ç†±æ›¿æ›

æ¨¡çµ„ç†±æ›¿æ› (HMR, Hot Module Replacement) å¯æå‡ä½ çš„é–‹ç™¼æ•ˆç‡ï¼Œæ¨¡çµ„ç†±æ›¿æ›ä¸¦ä¸æœƒé‡æ•´é é¢ï¼Œè€Œæ˜¯å³æ™‚åœ°æ›´æ–°ç€è¦½å™¨ä¸­çš„æ¨¡çµ„ï¼Œè®“ä½ å¾—ä»¥åœ¨æ›´å‹•æŸäº›å°åœ°æ–¹æ™‚ä»å¯ä¿ç•™åŸæœ¬çš„ç‹€æ…‹ã€‚Parcel æ”¯æ´ JavaScript åŠ CSS çš„æ¨¡çµ„ç†±æ›¿æ›ã€‚

å¾ 1.12.0 ç‰ˆé–‹å§‹é è¨­å·²æ”¹ç‚ºæ–¼æª”æ¡ˆæ›´å‹•æ™‚é‡æ•´é é¢ã€‚ä½ å¯ä»¥ç”¨ä¸‹åˆ—çš„æŒ‡ä»¤å•Ÿç”¨çœŸæ­£çš„æ¨¡çµ„ç†±æ›¿æ›ï¼Œé€™åƒ…é©ç”¨æ–¼é–‹ç™¼ç’°å¢ƒï¼Œæ¨¡çµ„ç†±æ›¿æ›åœ¨ production æ¨¡å¼ä¸­æœƒè‡ªå‹•åœç”¨ã€‚

```javascript
if (module.hot) {
  module.hot.accept()
}
```

Parcel æœƒåœ¨ä½ æ›´å‹•æª”æ¡ˆæ™‚é‡æ–°ç·¨è­¯æ›´å‹•çš„éƒ¨åˆ†ï¼Œä¸¦å°‡æ›´æ–°ç™¼é€è‡³æ‰€æœ‰æ­£åœ¨åŸ·è¡Œçš„ç”¨æˆ¶ç«¯ï¼Œä½¿ç”¨æ–°çš„ç¨‹å¼ç¢¼ä¾†æ›¿æ›èˆŠç‰ˆæœ¬ï¼ŒåŒæ™‚ä¹Ÿå°‡é‡æ–°è©•ä¼°æ‰€æœ‰çˆ¶å…ƒä»¶æ˜¯å¦éœ€è¦æ›´æ–°ã€‚ä½ å¯ä»¥ä½¿ç”¨ `module.hot` API ä¾†æ¶‰å…¥é€™å€‹éç¨‹ï¼Œå®ƒå¯ä»¥åœ¨æ¨¡çµ„å³å°‡è¢«è™•ç†æˆ–æœ‰æ–°ç‰ˆæœ¬å‚³å…¥æ™‚é€šçŸ¥ä½ çš„ç¨‹å¼ã€‚Parcel æ”¯æ´äº† [react-hot-loader](https://github.com/gaearon/react-hot-loader) ç­‰å°ˆæ¡ˆä»¥å”åŠ©é”æˆé€™å€‹éç¨‹ã€‚

Parcel æä¾›äº†å…©å€‹æ–¹æ³•ï¼š`module.hot.accept` åŠ `module.hot.dispose`ï¼Œå‰è€…èƒ½åœ¨æ¨¡çµ„æˆ–å…¶ç›¸ä¾å¥—ä»¶æ›´æ–°æ™‚åŸ·è¡Œå›å‘¼å‡½å¼ï¼Œå¾Œè€…å‰‡åœ¨æ¨¡çµ„å³å°‡è¢«æ›¿æ›æ™‚åŸ·è¡Œå›å‘¼å‡½å¼ã€‚

```javascript
if (module.hot) {
  module.hot.dispose(function() {
    // æ¨¡çµ„å³å°‡è¢«æ›¿æ›
  })

  module.hot.accept(function() {
    // æ¨¡çµ„æˆ–å…¶ç›¸ä¾å¥—ä»¶å‰›å‰›æ›´æ–°
  })
}
```

## è‡ªå‹•å®‰è£ç›¸ä¾å¥—ä»¶

ç‚ºäº†è®“é–‹ç™¼è€…å¯ä»¥ä¸ç”¨é›¢é–‹ Parcel æˆ–é–‹å•Ÿå¤šå€‹çµ‚ç«¯æ©Ÿè¦–çª—ï¼Œ Parcel åœ¨ `node_modules` ä¸­æ‰¾ä¸åˆ°ç›¸ä¾å¥—ä»¶æ™‚ï¼Œæœƒè‡ªå‹•å˜—è©¦ä½¿ç”¨ `yarn` æˆ– `npm` ä¾†å®‰è£ï¼ˆå–æ±ºæ–¼æ˜¯å¦æœ‰ `yarn.lock` é€™å€‹æª”æ¡ˆï¼‰ã€‚

æ­¤åŠŸèƒ½åªæœƒåœ¨ _development_ ï¼ˆä½¿ç”¨ [`serve`](cli.md#serve) æˆ– [`watch`](cli.md#watch) æ™‚ï¼‰ç’°å¢ƒä¸­å•Ÿç”¨ï¼Œåœ¨ _production_ ï¼ˆä½¿ç”¨ [`build`](cli.md#build) æ™‚ï¼‰ç’°å¢ƒæ™‚å‰‡æœƒè‡ªå‹•åœç”¨æ­¤åŠŸèƒ½ä»¥é¿å…ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚

ä½ å¯ä»¥é€é [`--no-autoinstall`](cli.md#disable-autoinstall) é¸é …åœç”¨æ­¤åŠŸèƒ½ã€‚

## å®‰å…¨å¯«å…¥

æœ‰äº›æ–‡å­—ç·¨è¼¯å™¨å’Œ IDE æä¾› `å®‰å…¨å¯«å…¥` åŠŸèƒ½ï¼Œæ­¤åŠŸèƒ½åŸºæœ¬ä¸Šæ˜¯åœ¨å­˜æª”æ™‚å¦å¤–è¤‡è£½ä¸€ä»½æª”æ¡ˆä¸¦é‡æ–°å‘½åï¼Œä»¥æ­¤é¿å…è³‡æ–™çš„éºå¤±ã€‚ä½†ä½¿ç”¨`å®‰å…¨å¯«å…¥`æ™‚ï¼Œ æ¨¡çµ„ç†±æ›¿æ›çš„æª”æ¡ˆæ›´æ–°åµæ¸¬æœƒè¢«æ­¤åŠŸèƒ½é˜»ç¤™ï¼Œè‹¥è¦åœç”¨`å®‰å…¨å¯«å…¥`å¯é€éä¸‹åˆ—çš„è¨­å®šæ–¹æ³•ï¼š

- `Sublime Text 3`ï¼šåœ¨è¨­å®šä¸­å¢åŠ  `atomic_save: "false"`ã€‚
- `IntelliJ`ï¼šåœ¨è¨­å®šä¸­æœå°‹ "safe write" ä¸¦åœç”¨ã€‚
- `Vim`ï¼š åœ¨è¨­å®šä¸­æ–°å¢ `:set backupcopy=yes`ã€‚
- `WebStorm`ï¼šåœ¨ Preferences > Appearance & Behavior > System Settings ä¸­å–æ¶ˆå‹¾é¸ `Use "safe write"`ã€‚
