# ğŸ”¥ çƒ­æ¨¡å—é‡è½½(HMR)

çƒ­æ¨¡å—é‡è½½ (HMR) åœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ›´æ–°æµè§ˆå™¨ä¸­çš„æ¨¡å—ä¼˜åŒ–å¼€å‘ä½“éªŒï¼Œæ— éœ€åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚è¿™æ„å‘³ç€åœ¨æ‚¨ä»£ç å°å¹…æ›´æ”¹æ—¶å¯ä»¥ä¿ç•™åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚Parcel çš„ HMR å®ç°æ”¯æŒå¼€ç®±å³ç”¨çš„ JavaScript å’Œ CSS èµ„æºã€‚HMR æ„å»ºåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹æ—¶è‡ªåŠ¨ç¦ç”¨ã€‚

ä¿å­˜æ–‡ä»¶æ—¶ï¼ŒParcel å°†é‡æ–°ç¼–è¯‘æ‰€æ›´æ”¹çš„å†…å®¹ï¼Œå¹¶å°†åŒ…å«æ–°ä»£ç çš„æ›´æ–°å‘é€åˆ°ä»»ä½•æ­£åœ¨è¿è¡Œçš„å®¢æˆ·ç«¯ã€‚æ–°çš„ä»£ç ä¼šæ›¿æ¢æ—§ç‰ˆæœ¬çš„ä»£ç å¹¶æ‰§è¡Œï¼Œå…¶æ‰€æœ‰çˆ¶æ¨¡å—ä»£ç ä¹Ÿä¼šé‡æ–°æ‰§è¡Œã€‚ä½ å¯ä»¥ä½¿ç”¨ `module.hot` API å¯¹æ­¤è¿‡ç¨‹è¿›è¡Œ hook ï¼Œç¼–å†™è¿™æ®µä»£ç ä¼šåœ¨ä½ å¤„ç†æ¨¡å—æ—¶æˆ–æœ‰æ–°ç‰ˆæœ¬è¿›å…¥æ—¶é€šçŸ¥æ‚¨ã€‚ç±»ä¼¼é¡¹ç›® [react-hot-loader](https://github.com/gaearon/react-hot-loader) å¯ä»¥å¸®åŠ©ä½ å®Œæˆè¯¥è¿‡ç¨‹ï¼Œå¹¶é€šè¿‡ Parcel å®ç°å¼€ç®±å³ç”¨ã€‚

æœ‰ä¸¤ç§å·²çŸ¥æ–¹æ³•ï¼š `module.hot.accept` å’Œ `module.hot.dispose` ã€‚ä½ å¯ä»¥è°ƒç”¨ `module.hot.accept` å¹¶èµ‹äºˆä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨æ¨¡å—æˆ–å…¶ä»–ä¾èµ–é¡¹è¢«æ›´æ–°æ—¶æ‰§è¡Œã€‚å½“è¯¥æ¨¡å—å³å°†è¢«æ›¿æ¢æ—¶ï¼Œ`module.hot.dispose` å›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚

```javascript
if (module.hot) {
  module.hot.dispose(function() {
    // æ¨¡å—å³å°†è¢«æ›¿æ¢æ—¶
  })

  module.hot.accept(function() {
    // æ¨¡å—æˆ–å…¶ä¾èµ–é¡¹ä¹‹ä¸€åˆšåˆšæ›´æ–°æ—¶
  })
}
```

## è‡ªåŠ¨å®‰è£…ä¾èµ–é¡¹

æ¯å½“ Parcel é‡åˆ°ç¬¦åˆ node_module æ¨¡å¼ä¸”æ— æ³•æ‰¾åˆ°å®ƒçš„ä¾èµ–é¡¹æ—¶ï¼ŒParcel ä¼šå°è¯•ä½¿ç”¨ yarn æˆ– npm å®‰è£…æ­¤ä¾èµ–é¡¹è¿™å–å†³äºæ˜¯å¦æ‰¾åˆ° yarn.lock æ–‡ä»¶ã€‚è¿™å¯ä»¥é¿å…å¼€å‘äººå‘˜ä¸å¾—ä¸é€€å‡º parcel æˆ–æ‰“å¼€å¤šä¸ªç»ˆç«¯çª—å£æ¥å®‰è£…ä¾èµ–ã€‚

è¿™åªä¼šåœ¨ _development_ æ¨¡å¼ä¸‹è§¦å‘ï¼ˆä½¿ç”¨ [`serve`](cli.md#serve) æˆ– [`watch`](cli.md#watch)ï¼‰ï¼Œç„¶è€Œåœ¨ç”Ÿäº§æ¨¡å¼æ˜¯ç¦æ­¢çš„ï¼ˆä½¿ç”¨[`build`](cli.md#build)ï¼‰è¿™æ ·é¿å…åœ¨éƒ¨ç½²çš„æ—¶å€™äº§ç”Ÿæ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ã€‚

ä½ å¯ä»¥ç¦æ­¢ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ [`--no-autoinstall`](cli.md#disable-autoinstall)ã€‚

## å®‰å…¨å†™å…¥(Safe Write)

ä¸€äº›æ–‡æœ¬ç¼–è¾‘å™¨å’Œ IDE å‡æœ‰`å®‰å…¨å†™å…¥`çš„åŠŸèƒ½ï¼Œè¿™åŸºæœ¬ä¸Šå¯ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé€šè¿‡è·å–æ–‡æœ¬çš„å‰¯æœ¬å¹¶åœ¨ä¿å­˜æ—¶å¯¹å…¶è¿›è¡Œé‡å‘½åæ“ä½œã€‚

å½“ä½¿ç”¨çƒ­æ¨¡å—é‡è½½ (HMR) æ—¶ï¼Œæ­¤åŠŸèƒ½ä¼šé˜»æ­¢æ–‡ä»¶æ›´æ–°çš„è‡ªåŠ¨æ£€æµ‹ï¼Œè¦ç¦ç”¨`å®‰å…¨å†™å…¥`ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—æä¾›çš„é€‰é¡¹:

- `Sublime Text 3` å°† atomic_save: "false" æ·»åŠ åˆ°ä½ ç”¨æˆ·è®¾ç½®ä¸­ã€‚
- `IntelliJ` åœ¨è®¾ç½®ä¸­ä½¿ç”¨æœç´¢æ¥æŸ¥æ‰¾ "safe write" å¹¶å°†å…¶ç¦ç”¨ã€‚
- `Vim` æ·»åŠ  :set backupcopy=yes åˆ°ä½ çš„è®¾ç½®ä¸­.
- `WebStorm` åœ¨ Preferences > Appearance & Behavior > System Settings ä¸­å–æ¶ˆé€‰ä¸­ "safe write" é€‰é¡¹ã€‚
