---
layout: layout.njk
eleventyNavigation:
  title: ðŸšš Migration
  order: 5
summary: Some tips for migration from Parcel 1 to Parcel 2
---

For the most part, you shouldn't have to change much when upgrading to Parcel 2:

## Code Changes

### Importing non-code assets from Javascript

If you want import the url to an image (or a soundfile, etc.) from Javascript, you need to prepend `url:` to the module specifier (more details in [Plugin Configuration](</getting-started/plugin-config/#predefined-(offical)-named-pipelines>))

{% migration %}
{% samplefile "index.js" %}

```js/0
import logo from "./logo.svg";

document.body.innerHTML = `<img src="${logo}">`;
```

{% endsamplefile %}
{% samplefile %}

```js/0
import logo from "url:./logo.svg";

document.body.innerHTML = `<img src="${logo}">`;
```

{% endsamplefile %}
{% endmigration %}

Alternatively, you can use a custom `.parcelrc` to opt into the old behaviour.

{% migration %}
{% samplefile ".parcelrc" %}

```json/3
{
  "extends": "@parcel/config-default",
  "transformers": {
    "*": ["@parcel/transformer-raw"]
  }
}
```

{% endsamplefile %}
{% endmigration %}

### Typescript

Parcel 1 transpiled TypeScript using `tsc` (the official TypeScript compiler). Parcel 2 instead uses Babel (using `@babel/preset-env`) by default. This has two notable consequences:

(The [TypeScript recipe](/recipes/typescript) contains more informations - and limitations - of Parcel's TypeScript handling.)

###### `@babel/preset-typescript` Isn't inserted Automatically into a Custom `.babelrc`.

For most use cases, transpiling using Babel is enough, so Parcel includes `@babel/preset-typescript` in its default Babel config for TypeScript assets. You need to specify it manually however if you are using a custom `.babelrc`:

{% migration %}
{% samplefile ".babelrc" %}

```json/1
{
  "presets": ["@babel/preset-env"],
  "plugins": ["babel-plugin-foo"]
}
```

{% endsamplefile %}
{% samplefile ".babelrc" %}

```json/1
{
  "presets": ["@babel/preset-env", "@babel/preset-typescript"],
  "plugins": ["babel-plugin-foo"]
}
```

{% endsamplefile %}
{% endmigration %}

###### Babel Doesn't Read `tsconfig.json`

In case Babel doesn't work for you (e.g. because of an advanced `tsconfig.json`), you can use `tsc`:

{% migration %}
{% samplefile ".parcelrc" %}

```json/3
{
  "extends": "@parcel/config-default",
  "transformers": {
    "*.{ts,tsx}": ["@parcel/transformer-typescript-tsc"]
  }
}
```

{% endsamplefile %}
{% endmigration %}

{% warning %}
This is expected to be slightly slower for large builds/assets, so transpiling using Babel is the default approach.
{% endwarning %}

### Importing GraphQL

When import GraphQL files (`.gql`), imports are still resolved/inlined (using `graphql-import-macro`), but you now get the processed GraphQL query as a string instead of an Apollo AST.

{% migration %}
{% samplefile "DataComponent.js" %}

```js
import fetchDataQuery from "./fetchData.gql"; // fetchDataQuery is the parsed AST

const DataComponent = () => {
  const { data } = useQuery(test, {
    fetchPolicy: "cache-and-network",
  });

  // ...
};
```

{% endsamplefile %}
{% samplefile "DataComponent.js" %}

```js/5
import gql from 'graphql-tag';

import fetchDataQuery from "./fetchData.gql"; // fetchDataQuery is a string

// Convert to the Apollo Specific Query AST
const parsedFetchDataQuery = gql(test);

const DataComponent = () => {
  const { data } = useQuery(parsedFetchDataQuery, {
    fetchPolicy: "cache-and-network",
  });

  // ...
};
```

{% endsamplefile %}
{% endmigration %}


{% note %}
With Parcel 2's new plugin architecture, creating a plugin that parses the string into an AST at build time (as Parcel 1 did) is very easy.
{% endnote %}

## Configuration/CLI

### `package.json#main`

Many `package.json`s (e.g. the one generated by `npm init`) contains `main: "index.js"` which ignored by most tools (for non-library projects). Parcel 2 will however use that value as the output path (see [Configuration#main](/getting-started/configuration#main-%2F-module-%2F-browser)),
for most web apps, this line should simply be removed.

### `--target`

This CLI flag is now inferred from your `package.json`, one of these three properties is enough (number denotes priority).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --target node
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/3,5,10
{
  targets: {
    default: {
      context: "node", // <--- (1)
      engines: {
        node: "10", // <------ (2)
      },
    },
  },
  engines: {
    node: "10", // <---------- (3)
  },
}
```

{% endsamplefile %}
{% endmigration %}

### `--experimental-scope-hoisting`

Parcel 2 has scope hoisting enabled by default; to disable it, add `--no-scope-hoist`.

{% migration %}
{% samplefile %}

```bash
parcel build index.js --experimental-scope-hoisting
parcel build index.js
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.js
parcel build index.js --no-scope-hoist
```

{% endsamplefile %}
{% endmigration %}

### `--bundle-node-modules`

To bundle packages from `node_modules` when targetting Node.js, you now should specify that in the target configuration:

{% migration %}
{% samplefile %}

```bash
parcel build index.js --target node --bundle-node-modules
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/8
{
  "default": "dist/index.js"
  "targets": {
    "default": {
      "includeNodeModules": true
    }
  },
  "engines": {
    "node": "10"
  }
}
```

{% endsamplefile %}
{% endmigration %}

{% note %}

This option is more versatile that the CLI parameter (you can also selectively include packages), see [Configuration#includeNodeModules](/getting-started/configuration/#includenodemodules) for all details.

{% endnote %}

### `--out-dir`

To align `--out-dir` with the options in [`package.json#targets`](/configuration/package-json/#targets), that option was renamed to `--dist-dir`.

{% migration %}
{% samplefile %}

```bash
parcel build index.html --out-dir www
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.html --dist-dir www
```

{% endsamplefile %}
{% endmigration %}

### `--out-file`

This flag, was removed and the path should instead be be specified in `package.json` (see [Configuration](/configuration/package-json/#custom-targets)).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --out-file lib.js
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/1
{
  default: "lib.js",
  // ...
}
```

{% endsamplefile %}
{% endmigration %}

### `--log-level`

The log levels now have names instead of numbers (`none`, `error`, `warn`, `info`, `verbose`)

{% migration %}
{% samplefile %}

```bash
parcel build index.js --log-level 1
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.js --log-level error
```

{% endsamplefile %}
{% endmigration %}

### `--global`

This option has been removed without a replacement (for now).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --global mylib
```

{% endsamplefile %}
{% samplefile %}
{% endsamplefile %}
{% endmigration %}
