---
layout: layout.njk
eleventyNavigation:
  key: getting-started-migration
  title: ðŸšš Migration
  order: 5
summary: Some tips for upgrading from Parcel 1 to Parcel 2
---

For the most part, you shouldn't have to change much when upgrading to Parcel 2:

## Code Changes

### Importing non-code assets from Javascript

If you want import the url to an image (or a soundfile, etc.) from Javascript, you need to prepend `url:` to the module specifier (read more about named pipelines in [Plugin Configuration](</configuration/plugin-configuration/#predefined-(offical)-named-pipelines>))

{% migration %}
{% samplefile "index.js" %}

```js/0
import logo from "./logo.svg";

document.body.innerHTML = `<img src="${logo}">`;
```

{% endsamplefile %}
{% samplefile %}

```js/0
import logo from "url:./logo.svg";

document.body.innerHTML = `<img src="${logo}">`;
```

{% endsamplefile %}
{% endmigration %}

Alternatively, you can use a custom `.parcelrc` to opt into the old behaviour (add more asset extensions if you use them):

{% migration %}
{% samplefile ".parcelrc" %}

```json/3
{
  "extends": "@parcel/config-default",
  "transformers": {
    "*.{jpg,png,svg}": ["@parcel/transformer-raw"]
  }
}
```

{% endsamplefile %}
{% endmigration %}

### Typescript

Parcel 1 transpiled TypeScript using `tsc` (the official TypeScript compiler). Parcel 2 instead uses Babel (using `@babel/preset-env`) by default. This has two notable consequences:

(The [TypeScript page](/languages/typescript) contains more informations - and limitations - of Parcel's TypeScript handling.)

###### `@babel/preset-typescript` Isn't inserted Automatically into a Custom `.babelrc`.

For most use cases, transpiling using Babel is enough, so Parcel includes `@babel/preset-typescript` in its default Babel config for TypeScript assets. You need to specify it manually however if you are using a custom `.babelrc`:

{% migration %}
{% samplefile ".babelrc" %}

```json/1
{
  "presets": ["@babel/preset-env"],
  "plugins": ["babel-plugin-foo"]
}
```

{% endsamplefile %}
{% samplefile ".babelrc" %}

```json/1
{
  "presets": ["@babel/preset-env", "@babel/preset-typescript"],
  "plugins": ["babel-plugin-foo"]
}
```

{% endsamplefile %}
{% endmigration %}

###### Babel Doesn't Read `tsconfig.json`

In case Babel doesn't work for you (e.g. because of an advanced `tsconfig.json`), you can use `tsc`:

{% migration %}
{% samplefile ".parcelrc" %}

```json/3
{
  "extends": "@parcel/config-default",
  "transformers": {
    "*.{ts,tsx}": ["@parcel/transformer-typescript-tsc"]
  }
}
```

{% endsamplefile %}
{% endmigration %}

{% warning %}
This is expected to be slightly slower for large builds/assets, so transpiling using Babel is the default approach.
{% endwarning %}

### Importing GraphQL

When import GraphQL files (`.gql`), imports are still resolved/inlined (using `graphql-import-macro`), but you now get the processed GraphQL query as a string instead of an Apollo AST.

{% migration %}
{% samplefile "DataComponent.js" %}

```js
import fetchDataQuery from "./fetchData.gql"; // fetchDataQuery is the parsed AST

const DataComponent = () => {
  const { data } = useQuery(test, {
    fetchPolicy: "cache-and-network",
  });

  // ...
};
```

{% endsamplefile %}
{% samplefile "DataComponent.js" %}

```js/5
import gql from "graphql-tag";

import fetchDataQuery from "./fetchData.gql"; // fetchDataQuery is a string

// Convert to the Apollo Specific Query AST
const parsedFetchDataQuery = gql(fetchDataQuery);

const DataComponent = () => {
  const { data } = useQuery(parsedFetchDataQuery, {
    fetchPolicy: "cache-and-network",
  });

  // ...
};
```

{% endsamplefile %}
{% endmigration %}

{% note %}
With Parcel 2's new plugin architecture, creating a plugin that parses the string into an AST at build time (as Parcel 1 did) is very easy.
{% endnote %}

### Hooking into Bundle Events

Parcel 1 let you hook in and listen to events like `buildEnd` or `buildError`. The API has changed but you can still listen for events like so:

{% migration %}
{% samplefile "index.js" %}

```js/0
import Bundler from "parcel-bundler"

const bundler = new Bundler({ /* ... */ })
bundler.bundle()

bundler.on("buildEnd", () => { /* ... */ })

bundler.on("buildError", (error) => { /* ... */ })
```

{% endsamplefile %}
{% samplefile %}

```js/0
import Parcel from "@parcel/core"

const bundler = new Parcel({ /* ... */ })

bundler.watch((err, buildEvent) => {
  if(buildEvent.type === "buildSuccess") { /* ... */ }

  if(buildEvent.type === "buildFailure") { /* ... */ }
})
```

{% endsamplefile %}
{% endmigration %}

## Configuration/CLI

### Transpilation

By default, Parcel 2 doesn't downlevel your source code anymore. If you want this to happen, you should [specify a browserslist](/getting-started/webapp/#browserslist) to only target the browsers you want to support.

### `package.json#main`

Many `package.json`s (e.g. the one generated by `npm init`) contain `main: "index.js"` which is ignored by most tools (for non-library projects). Parcel 2 will however use that value as the output path; for most web apps, this line should simply be removed. If you really do need it, you can add `"targets": { "main": false }` to your `package.json`. See [Configuration#main](/configuration/package-json/#main-%2F-module-%2F-browser)

### `--target`

This CLI flag is now inferred from your `package.json`, one of these three properties is enough (number denotes priority).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --target node
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/3,5,10
{
  "targets": {
    "default": {
      "context": "node", // <--- (1)
      "engines": {
        "node": "10", // <------ (2)
      },
    },
  },
  "engines": {
    "node": "10", // <---------- (3)
  },
}
```

{% endsamplefile %}
{% endmigration %}

### `--experimental-scope-hoisting`

Parcel 2 has scope hoisting enabled by default; to disable it, add `--no-scope-hoist`.

{% migration %}
{% samplefile %}

```bash
parcel build index.js --experimental-scope-hoisting
parcel build index.js
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.js
parcel build index.js --no-scope-hoist
```

{% endsamplefile %}
{% endmigration %}

### `--bundle-node-modules`

To bundle packages from `node_modules` when targetting Node.js, you now should specify that in the target configuration:

{% migration %}
{% samplefile %}

```bash
parcel build index.js --target node --bundle-node-modules
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/8
{
  "default": "dist/index.js"
  "targets": {
    "default": {
      "includeNodeModules": true
    }
  },
  "engines": {
    "node": "10"
  }
}
```

{% endsamplefile %}
{% endmigration %}

{% note %}

This option is more versatile that the CLI parameter (you can also selectively include packages), see [Configuration#includeNodeModules](/configuration/package-json/#includenodemodules) for all details.

{% endnote %}

### `--out-dir`

To align `--out-dir` with the options in [`package.json#targets`](/configuration/package-json/#targets), that option was renamed to `--dist-dir`.

{% migration %}
{% samplefile %}

```bash
parcel build index.html --out-dir www
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.html --dist-dir www
```

{% endsamplefile %}
{% endmigration %}

### `--out-file`

This flag, was removed and the path should instead be be specified in `package.json` (see [Configuration](/configuration/package-json/#custom-targets)).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --out-file lib.js
```

{% endsamplefile %}
{% samplefile "package.json" %}

```json5/1
{
  "default": "lib.js",
  // ...
}
```

{% endsamplefile %}
{% endmigration %}

### `--log-level`

The log levels now have names instead of numbers (`none`, `error`, `warn`, `info`, `verbose`)

{% migration %}
{% samplefile %}

```bash
parcel build index.js --log-level 1
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.js --log-level error
```

{% endsamplefile %}
{% endmigration %}

### `--global`

This option has been removed without a replacement (for now).

{% migration %}
{% samplefile %}

```bash
parcel build index.js --global mylib
```

{% endsamplefile %}
{% samplefile %}
{% endsamplefile %}
{% endmigration %}

### `--no-minify`

This option has been renamed to `--no-optimize`

{% migration %}
{% samplefile %}

```bash
parcel build index.js --no-minify
```

{% endsamplefile %}
{% samplefile %}

```bash
parcel build index.js --no-optimize
```

{% endsamplefile %}
{% endmigration %}
